
<html><head>
  <title>Hyperbolic Tessellator</title>
  <script src="./scripts/main.js" type="text/javascript"></script>

  <script id="vs" type="x-shader/x-vertex">
   attribute vec3 position;

   void main(void){
     gl_Position = vec4(position, 1.0);
   }
  </script>

  <script id="fs" type="x-shader/x-fragment">
   precision mediump float;

   uniform float iGlobalTime;
   uniform vec2 iResolution;
   uniform vec2 camResolution;
   uniform sampler2D texture;

   vec2 rand2n(vec2 co, float sampleIndex) {
     vec2 seed = co * (sampleIndex + 1.0);
     seed+=vec2(-1,1);
     // implementation based on: lumina.sourceforge.net/Tutorials/Noise.html
     return vec2(fract(sin(dot(seed.xy ,vec2(12.9898,78.233))) * 43758.5453),
                 fract(cos(dot(seed.xy ,vec2(4.898,7.23))) * 23421.631));
   }

   const float sampleNum = 50.;
   const float PI = 3.141592653589;
   void main(){
     float ratio = iResolution.x / iResolution.y / 2.0;

     vec3 sum = vec3(0.);
     float theta = PI / 4. + PI/6. * sin(iGlobalTime);
     float xc = 50. * 2. * cos(theta);
     float yc = 50. * 2. * sin(theta);
     vec2 tileSize = vec2(xc, yc);
     for(float i = 0. ; i < sampleNum ; i++){
       vec2 position = ( (gl_FragCoord.xy + rand2n(gl_FragCoord.xy, i)) / iResolution.yy ) - vec2(ratio, 0.5);
       position *= 100.;

       vec2 p = position - tileSize * floor(position / tileSize) - tileSize / 2.;
       float angle = atan(p.y, p.x);

       if(mod(floor(angle / (PI/2.0)), 2.0) == 0. ){
         if(mod(angle, PI/2.0) < theta){
           sum += vec3(1) * texture2D(texture, abs(vec2(1.,1.)-(p + tileSize / 2.) / tileSize )).rgb;
         }else{
           sum += vec3(1) * texture2D(texture, abs(vec2(0.,0.)-(p + tileSize / 2.) / tileSize )).rgb;
         }
       }else{
    	 if(mod(angle, PI/2.0) < PI / 2.0 - theta){
           sum += vec3(1) * texture2D(texture, abs(vec2(0.,1.)-(p + tileSize / 2.) / tileSize )).rgb;
         }else{
           sum += vec3(1) * texture2D(texture, abs(vec2(1.,0.)-(p + tileSize / 2.) / tileSize )).rgb;
         }
       }
     }

     gl_FragColor = vec4(sum / sampleNum,1.);
   }
  </script>
  <style>
   canvas {
     background-color: black;
   }
  </style>
</head>
<body>
  <canvas id="canvas" width="512" height="512"></canvas>
</body></html>
